<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta name="description" content="https://dkensinger.github.io/">
    

    <meta property="og:site_name" content="d.kens">
    <meta property="og:title" content="d.kens">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://dkensinger.github.io/blog/fizz-buzz-deluxe-edition/">
    <meta property="og:image" content="https://dkensinger.github.io/">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="https://dkensinger.github.io/blog/fizz-buzz-deluxe-edition/">
    <meta name="twitter:image" content="https://dkensinger.github.io/">

    
    <link rel="stylesheet" type="text/css" href="https://dkensinger.github.io/css/style.css">
    
    
    

    <link rel="stylesheet" href="https://use.typekit.net/jxt2fnp.css"> 
    <link rel="stylesheet" href="https://use.typekit.net/uwd7war.css"> 
    <link href="https://fonts.cdnfonts.com/css/cooper-hewitt" rel="stylesheet">
    
    
        <meta name="description" content="A personal blog">
    

    
        
            <link rel="shortcut icon" href="/favicon.png">
        
    

    
        <script async src="https://analytics.eu.umami.is/script.js" data-website-id="a6fdbd07-6787-4292-9455-705ce886734a"></script>
    
    
    
    
    <title>fizz-buzz: deluxe edition | d.kens</title>
</head><body><div id="top-stripe"></div><div id="content">

    <div class="article-nav-outer">
        <div class="article-nav-inner">
            <a class="internal" hyphens="none" href="/blog">← back to blog</a>
        </div>
    </div>

<h2 class="article-title">Fizz-Buzz: deluxe edition</h2>
<div id="doc">
    <div class="hanging-subtitle">
        
        
            <p>by [Dave Kensinger]</p>
                
        
            
                <p>12 May 2017</p>
            
        
    </div>
<h2 id="origin-story">Origin story</h2>
<p>I remember a game I played in school called “Fizz Buzz” where we sat in a circle and progressed around the circle by counting up from “one”. The rule was: replace the number with “Fizz” if it was a multiple of 5, “Buzz” if it was a multiple of 7 and “FizzBuzz” if it was a multiple of both 5 and 7. There may have been some direction changes (and possibly drinking) involved but I can’t recall. It would look something like this:</p>
<p>&ldquo;one&rdquo; → &ldquo;two&rdquo; → &ldquo;three&rdquo; → &ldquo;four&rdquo; → &ldquo;fizz&rdquo; ← &ldquo;six&rdquo; ← &ldquo;buzz&rdquo; → &ldquo;eight&rdquo; → &ldquo;nine&rdquo; → &ldquo;fizz&rdquo;</p>
<p>Fast forward many years&hellip; everyone is encouraged to learn computer programming. A favorite exercise often used to teach or learn a programming language is to replicate this game. Another more challenging exercise is to add all the multiples of some numbers, usually 3 and 5, up to some limit. For example:</p>
<blockquote>
<p>If we list all the natural numbers below 10 that are multiples of 3 or 5, we get 3, 5, 6 and 9. The sum of these multiples is 23.</p>
<p><em>Find the sum of all the multiples of 3 or 5 below 1000.</em></p>
</blockquote>
<p>Check out this link to try it: <a href="https:projecteuler.net/problem=1">Project Euler #1</a></p>
<h2 id="easy-answers--danger-code-ahead">Easy answers (danger! code ahead)</h2>
<p>A straight-forward solution uses the basic tools any beginning programmer will quickly learn. In python, using a list comprehension, it might look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span> print(sum ([x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1000</span>) <span style="color:#66d9ef">if</span> (x <span style="color:#f92672">%</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">or</span> x <span style="color:#f92672">%</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#ae81ff">233168</span>
</span></span></code></pre></div><p>This is a correct solution&hellip; but we can do better! The problem with this solution lies here:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1000</span>)
</span></span></code></pre></div><p>So what is the problem?<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> This technique isn&rsquo;t as efficient as it could be. Its performance (speed) depends on the size of the range. In this example it steps through 1000 numbers, one at a time, checking if each number is evenly divisible by 3 or 5. It then adds the number to a list if either test is true. Finally, it takes that list and adds all the items. What if the question asked for the sum up to 1,000,000? or 1,000,000,000? Even with a fast processor these solutions will take a long time to produce an answer.
It turns out there is a way to shortcut this march through a long series of numbers.</p>
<h2 id="math-to-the-rescue">Math to the rescue!</h2>
<p>There is a mathematical formula that calculates the sum of a series of numbers (of course there is!). A nice explanation is here: <a href="https://en.wikipedia.org/wiki/Triangular_number?oldformat=true">Triangle Numbers</a> where you can see the sum of a series can be rewritten as a formula:</p>
<p>\(1 + 2 + 3 + … n = n(n+1)/2\)</p>
<p>With this insight I can find our answer to the sum of multiples question without marching through a list of numbers. Here’s how:</p>
<p>First let’s look at just the multiples of threes. A list of the multiples of 3 would look like this:</p>
<p>\(3 + 6 + 9 + … + 999\)</p>
<p>which can be re-written as</p>
<p>\(3 * (1 + 2 + 3 + … + 333)\)</p>
<p>or</p>
<p>\(3 * n(n+1)/2\)  (where n = 333)</p>
<p>In this case n = 333 which is 1000 divided by 3 dropping any remainder (called <em>integer division</em> and uses the <code>//</code> symbol in python). So a python function to calculate the sum of multiples of 3 below 1000 would be:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sum_of_threes</span> (factor<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, limit<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>		  n <span style="color:#f92672">=</span> limit <span style="color:#f92672">//</span> factor
</span></span><span style="display:flex;"><span>		  <span style="color:#66d9ef">return</span> factor <span style="color:#f92672">*</span> n <span style="color:#f92672">*</span> (n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> print(sum_of_threes())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#ae81ff">166833</span>
</span></span></code></pre></div><p>Note that this would work for <em>any</em> factor and <em>any</em> limit. I could also get the answer for multiples of five by passing 5 as an input to the function. So, to keep the function generic I will rename it to <code>sum_of_multiples</code> and use “factor” and “limit” as its inputs.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sum_of_multiples</span> (factor, limit):
</span></span><span style="display:flex;"><span>     n <span style="color:#f92672">=</span> (limit<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> factor
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">return</span> factor <span style="color:#f92672">*</span> n <span style="color:#f92672">*</span> (n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> print(sum_of_multiples(<span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">1000</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#ae81ff">71071</span>
</span></span></code></pre></div><h2 id="next-step">Next step</h2>
<p>Now that I have a quick way to calculate the sum of a series of multiples of one number up to a limit, I need to figure out how to do it with two numbers. I could call the function twice, once with a factor of 3 and again with a factor of 5, then add the two sums together! Let&rsquo;s see what we get:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">easy_answer</span>(limit):
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">return</span> sum([x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(limit) <span style="color:#66d9ef">if</span> x <span style="color:#f92672">%</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">or</span> x <span style="color:#f92672">%</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sum_of_multiples</span>(factor, limit):
</span></span><span style="display:flex;"><span>     n_count <span style="color:#f92672">=</span> (limit<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> factor
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">return</span> factor <span style="color:#f92672">*</span> n_count <span style="color:#f92672">*</span> (n_count <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> print(<span style="color:#e6db74">&#34;easy answer &#34;</span>, easy_answer(<span style="color:#ae81ff">1000</span>))
</span></span><span style="display:flex;"><span> print(<span style="color:#e6db74">&#34;faster answer &#34;</span>, sum_of_multiples(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1000</span>) <span style="color:#f92672">+</span> sum_of_multiples(<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">1000</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&gt;&gt;&gt;</span> easy answer  <span style="color:#ae81ff">233168</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&gt;&gt;&gt;</span> faster answer  <span style="color:#ae81ff">266333</span>
</span></span></code></pre></div><p>Wrong answer! My answer is too high. It is because I am counting some numbers twice. Those numbers that are evenly divisible by <em>BOTH</em> 3 <em>AND</em> 5 are counted twice, once in each subtotal. For example the threes list contains 15 and 30 and 45 &hellip; and the fives list contains 15 and 30 and 45&hellip; Therefore I must subtract the sum of the list of <em>common</em> multiples. To find all the common multiples I must use the <em>lowest common multiple</em> (LCM) of the two factors. In this case, using 3 and 5, the LCM is 15. Another example would use the LCM of 4 and 6 which is 12 (not 24).</p>
<p>So I must adjust our &ldquo;faster answer&rdquo; by subtracting <code>sum_of_multiples(15, 1000)</code>.</p>
<p>Let&rsquo;s see if it works!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">easy_answer</span>(limit):
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">return</span> sum([x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(limit) <span style="color:#66d9ef">if</span> x <span style="color:#f92672">%</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">or</span> x <span style="color:#f92672">%</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sum_of_multiples</span>(factor, limit):
</span></span><span style="display:flex;"><span>     n_count <span style="color:#f92672">=</span> (limit<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> factor
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">return</span> factor <span style="color:#f92672">*</span> n_count <span style="color:#f92672">*</span> (n_count <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> print(<span style="color:#e6db74">&#34;easy answer &#34;</span>, easy_answer(<span style="color:#ae81ff">1000</span>))
</span></span><span style="display:flex;"><span> print(<span style="color:#e6db74">&#34;faster answer &#34;</span>, sum_of_multiples(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1000</span>) <span style="color:#f92672">+</span> sum_of_multiples(<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">1000</span>) <span style="color:#f92672">-</span> sum_of_multiples(<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">1000</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&gt;&gt;&gt;</span> easy answer  <span style="color:#ae81ff">233168</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&gt;&gt;&gt;</span> faster answer  <span style="color:#ae81ff">233168</span>
</span></span></code></pre></div><p>It works! And to show that it is much faster when the limit is very high, I&rsquo;ll add some code to time each method using factors of 3 and 5 and a limit of 100,000,000.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span> <span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">easy_answer</span>(limit):
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">return</span> sum([x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(limit) <span style="color:#66d9ef">if</span> x <span style="color:#f92672">%</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">or</span> x <span style="color:#f92672">%</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sum_of_multiples</span>(factor, limit):
</span></span><span style="display:flex;"><span>     n_count <span style="color:#f92672">=</span> (limit<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> factor
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">return</span> factor <span style="color:#f92672">*</span> n_count <span style="color:#f92672">*</span> (n_count<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> t0 <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>clock()
</span></span><span style="display:flex;"><span> print(<span style="color:#e6db74">&#34;easy answer &#34;</span>, easy_answer(<span style="color:#ae81ff">100_000_000</span>))
</span></span><span style="display:flex;"><span> print(<span style="color:#e6db74">&#34;took &#34;</span>, time<span style="color:#f92672">.</span>clock()<span style="color:#f92672">-</span>t0, <span style="color:#e6db74">&#34;seconds&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> t0 <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>clock()
</span></span><span style="display:flex;"><span> print(<span style="color:#e6db74">&#34;faster answer &#34;</span>, sum_of_multiples(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">100_000_000</span>) <span style="color:#f92672">+</span> sum_of_multiples(<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">100_000_000</span>) <span style="color:#f92672">-</span> sum_of_multiples(<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">100_000_000</span>))
</span></span><span style="display:flex;"><span> print(<span style="color:#e6db74">&#34;took &#34;</span>, time<span style="color:#f92672">.</span>clock()<span style="color:#f92672">-</span>t0, <span style="color:#e6db74">&#34;seconds&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&gt;&gt;&gt;</span> easy answer  <span style="color:#ae81ff">2333333316666668</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&gt;&gt;&gt;</span> took  <span style="color:#ae81ff">13.653634</span> seconds
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&gt;&gt;&gt;</span> faster answer  <span style="color:#ae81ff">2333333316666668</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&gt;&gt;&gt;</span> took  <span style="color:#ae81ff">1.100000000064938e-05</span> seconds
</span></span></code></pre></div><p>There you can see the easy answer method took over 13 seconds to run while the faster method took only 0.000011 seconds! Thanks math!</p>
<p>But we can do better!</p>
<h2 id="going-further">Going further</h2>
<p>Before going further, I will switch over to the haskell programming language for the code examples. Hopefully you won&rsquo;t notice much of a difference (and I get to practice another language).</p>
<p>First, let&rsquo;s rewrite the python code to haskell code (without the timing):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-haskell" data-lang="haskell"><span style="display:flex;"><span> easyAnswer <span style="color:#f92672">::</span> <span style="color:#66d9ef">Integer</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Integer</span>
</span></span><span style="display:flex;"><span> easyAnswer limit <span style="color:#f92672">=</span> sum [x <span style="color:#f92672">|</span> x <span style="color:#f92672">&lt;-</span> [<span style="color:#ae81ff">1</span><span style="color:#f92672">..</span>limit<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], x `mod` <span style="color:#ae81ff">3</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> x `mod` <span style="color:#ae81ff">5</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> triangle <span style="color:#f92672">::</span> <span style="color:#66d9ef">Integer</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Integer</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Integer</span>
</span></span><span style="display:flex;"><span> triangle factor limit <span style="color:#f92672">=</span> factor <span style="color:#f92672">*</span> n <span style="color:#f92672">*</span> (n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) `div` <span style="color:#ae81ff">2</span> <span style="color:#66d9ef">where</span>
</span></span><span style="display:flex;"><span>                         n <span style="color:#f92672">=</span> (limit<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) `div` factor
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> sumOfMultiples <span style="color:#f92672">::</span> <span style="color:#66d9ef">Integer</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Integer</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Integer</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Integer</span>
</span></span><span style="display:flex;"><span> sumOfMultiples factor1 factor2 limit <span style="color:#f92672">=</span> triangle factor1 limit <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>                                        triangle factor2 limit <span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span>                                        triangle (lcm factor1 factor2) limit
</span></span></code></pre></div><p>You&rsquo;ll hopefully notice many similarities like the list comprehension and the triangle function. Also, you can see a term <code>lcm</code> which is a function that does what I want: find the lowest common multiple of two integers.</p>
<p>So how can I go further? I can make the <code>sumOfMultiples</code> function truly generic so it can take <em>any number</em> of factors and find the sum of their multiples up to a limit. For example, I could find the sum of the multiples of 3, 5 and 7 below 1,000. Before I start, I&rsquo;ll get the right answer using the easy method so I know what we&rsquo;re looking for. In fact, I&rsquo;ll build up a table of sums as I go along.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-haskell" data-lang="haskell"><span style="display:flex;"><span> easyAnswer <span style="color:#f92672">=</span> sum [x <span style="color:#f92672">|</span> x <span style="color:#f92672">&lt;-</span> [<span style="color:#ae81ff">1</span><span style="color:#f92672">..</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], x `mod` <span style="color:#ae81ff">3</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>                                         x `mod` <span style="color:#ae81ff">5</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>                                         x `mod` <span style="color:#ae81ff">7</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> easyAnswer
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">271066</span>
</span></span></code></pre></div><p>My answer is: 271066 (I&rsquo;ll call this my target number)</p>
<p>And now, using a limit of 1000, I&rsquo;ll make a table of sums of multiples of 3, 5 and 7. I already know we&rsquo;re going to subtract the sum of the LCM&rsquo;s of 3 &amp; 5 (from our previous solution)&hellip; and now I&rsquo;ll have to subtract LCM&rsquo;s for 3 &amp; 7 AND 5 &amp; 7. And for good measure, I&rsquo;ll include the LCM for 3 &amp; 5 &amp; 7 to see if I need it. Finally, I&rsquo;ll add some additional details in the table (I have a feeling I&rsquo;ll need them).</p>
<table>
<thead>
<tr>
<th>factors</th>
<th># factors</th>
<th>LCM</th>
<th>sum (1000)</th>
</tr>
</thead>
<tbody>
<tr>
<td>3</td>
<td>1</td>
<td>3</td>
<td>166833</td>
</tr>
<tr>
<td>5</td>
<td>1</td>
<td>5</td>
<td>99500</td>
</tr>
<tr>
<td>7</td>
<td>1</td>
<td>7</td>
<td>71071</td>
</tr>
<tr>
<td>3, 5</td>
<td>2</td>
<td>15</td>
<td>33165</td>
</tr>
<tr>
<td>3, 7</td>
<td>2</td>
<td>21</td>
<td>23688</td>
</tr>
<tr>
<td>5, 7</td>
<td>2</td>
<td>35</td>
<td>14210</td>
</tr>
<tr>
<td>3, 5, 7</td>
<td>3</td>
<td>105</td>
<td>4725</td>
</tr>
</tbody>
</table>
<p>If I follow my earlier strategy, I will first add the 3&rsquo;s, 5&rsquo;s and 7&rsquo;s and then subtract the 3&amp;5, 3&amp;7 and 5&amp;7 sums. That result is 266341. Exactly 4725 too low! It turns out that when I subtract all three pairs I need to add back the 3&amp;5&amp;7 triple. When I do, I get a total sum of 271066!</p>
<p>I feel like I got lucky there, so I am going to go to the next level and try 4 factors and see how it adds up. I&rsquo;ll use 3, 5, 7, and 11 as my factors and a limit of 10,000 this time. Using the <code>easyAnswer</code> method I get a target number of: 29224307.</p>
<p>I&rsquo;ll build up my table again (using the <code>easyAnswer</code> method for each row):</p>
<table>
<thead>
<tr>
<th>factors</th>
<th># factors</th>
<th>LCM</th>
<th>sum (10,000)</th>
</tr>
</thead>
<tbody>
<tr>
<td>3</td>
<td>1</td>
<td>3</td>
<td>16668333</td>
</tr>
<tr>
<td>5</td>
<td>1</td>
<td>5</td>
<td>9995000</td>
</tr>
<tr>
<td>7</td>
<td>1</td>
<td>7</td>
<td>7142142</td>
</tr>
<tr>
<td>11</td>
<td>1</td>
<td>11</td>
<td>4549545</td>
</tr>
<tr>
<td>3, 5</td>
<td>2</td>
<td>15</td>
<td>3331665</td>
</tr>
<tr>
<td>3, 7</td>
<td>2</td>
<td>21</td>
<td>2384046</td>
</tr>
<tr>
<td>3, 11</td>
<td>2</td>
<td>33</td>
<td>1519848</td>
</tr>
<tr>
<td>5, 7</td>
<td>2</td>
<td>35</td>
<td>1426425</td>
</tr>
<tr>
<td>5, 11</td>
<td>2</td>
<td>55</td>
<td>905905</td>
</tr>
<tr>
<td>7, 11</td>
<td>2</td>
<td>77</td>
<td>645645</td>
</tr>
<tr>
<td>3, 5, 7</td>
<td>3</td>
<td>105</td>
<td>478800</td>
</tr>
<tr>
<td>3, 5, 11</td>
<td>3</td>
<td>165</td>
<td>301950</td>
</tr>
<tr>
<td>3, 7, 11</td>
<td>3</td>
<td>231</td>
<td>218526</td>
</tr>
<tr>
<td>5, 7, 11</td>
<td>3</td>
<td>385</td>
<td>125125</td>
</tr>
<tr>
<td>3, 5, 7, 11</td>
<td>4</td>
<td>1155</td>
<td>41580</td>
</tr>
</tbody>
</table>
<p>Whew! Things are getting complicated! Now I&rsquo;ll follow my strategy again: add the sums of the single factors, subtract the sums of the pairs LCM, then add back the sums of the triples. I get a total of 29265887. Exactly 41580 too high! So it looks as though I must <em>subtract</em> the last quartet (3&amp;5&amp;7&amp;11) LCM for a total of 29224307: my target number!</p>
<p>Now I think I have enough examples to build a general case. Here&rsquo;s what my intuition leads me to:</p>
<p><code>the sum of multiples of all factors =</code></p>
<p><code>the sum of the LCM sums if the number of factors is odd</code></p>
<p><code>MINUS</code></p>
<p><code>the sum of the LCM sums if the number of factors is even</code></p>
<p>Before I get the to the final code, I should figure out how to generate some of the data in our table automatically. First, I need an easy way to generate the sets of factors in column 1. Searching through the <code>Data.List</code> module I found the function <code>subsequences</code> which takes a list and outputs a list of all subsequences from the input. Just what I need!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-haskell" data-lang="haskell"><span style="display:flex;"><span> <span style="color:#66d9ef">import</span> Data.List (<span style="color:#a6e22e">subsequences</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> subsequences [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">11</span>]
</span></span><span style="display:flex;"><span> [<span style="color:#66d9ef">[]</span>,[<span style="color:#ae81ff">3</span>],[<span style="color:#ae81ff">5</span>],[<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>],[<span style="color:#ae81ff">7</span>],[<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">7</span>],[<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">7</span>],[<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">7</span>],[<span style="color:#ae81ff">11</span>],[<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">11</span>],[<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">11</span>],[<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">11</span>],[<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">11</span>],[<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">11</span>],[<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">11</span>],[<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">11</span>]]
</span></span></code></pre></div><p>Perfect! (except for the empty list [] at the beginning)</p>
<p>Second, I need a way to calculate the LCM of not just two factors but <em>any</em> number of factors. Here is where a <code>foldl</code> can help:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-haskell" data-lang="haskell"><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> foldl lcm <span style="color:#ae81ff">1</span> [<span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> foldl lcm <span style="color:#ae81ff">1</span> [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>]
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> foldl lcm <span style="color:#ae81ff">1</span> [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">7</span>]
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">105</span>
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> foldl lcm <span style="color:#ae81ff">1</span> [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">11</span>]
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">1155</span>
</span></span></code></pre></div><p>Perfect! We&rsquo;re now ready to put it all together:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-haskell" data-lang="haskell"><span style="display:flex;"><span> <span style="color:#66d9ef">import</span> Data.List (<span style="color:#a6e22e">subsequences</span>, <span style="color:#a6e22e">length</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> factorsList <span style="color:#f92672">::</span> [<span style="color:#66d9ef">Integer</span>] <span style="color:#f92672">-&gt;</span> [(<span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">Integer</span>)]
</span></span><span style="display:flex;"><span> factorsList factors <span style="color:#f92672">=</span> [(length a, foldl lcm <span style="color:#ae81ff">1</span> a) <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>                        a <span style="color:#f92672">&lt;-</span> subsequences factors, a <span style="color:#f92672">/=</span> <span style="color:#66d9ef">[]</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> triangle <span style="color:#f92672">::</span> (<span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">Integer</span>) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Integer</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Integer</span>
</span></span><span style="display:flex;"><span> triangle (<span style="color:#66d9ef">_</span>, b) n <span style="color:#f92672">=</span> b <span style="color:#f92672">*</span> ((n `div` b) <span style="color:#f92672">*</span> ( n `div` b <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)) `div` <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> triangleListPlus <span style="color:#f92672">::</span> [<span style="color:#66d9ef">Integer</span>] <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Integer</span> <span style="color:#f92672">-&gt;</span> [<span style="color:#66d9ef">Integer</span>]
</span></span><span style="display:flex;"><span> triangleListPlus factors limit <span style="color:#f92672">=</span> [triangle (a, b) (limit<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>                                   (a, b) <span style="color:#f92672">&lt;-</span> factorsList factors, odd a]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> triangleListMinus <span style="color:#f92672">::</span> [<span style="color:#66d9ef">Integer</span>] <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Integer</span> <span style="color:#f92672">-&gt;</span> [<span style="color:#66d9ef">Integer</span>]
</span></span><span style="display:flex;"><span> triangleListMinus factors limit <span style="color:#f92672">=</span> [triangle (a, b) (limit<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>                                    (a, b) <span style="color:#f92672">&lt;-</span> factorsList factors, even a]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> sumOfMultiples <span style="color:#f92672">::</span> [<span style="color:#66d9ef">Integer</span>] <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Integer</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Integer</span>
</span></span><span style="display:flex;"><span> sumOfMultiples factors limit <span style="color:#f92672">=</span> sum(triangleListPlus factors limit) <span style="color:#f92672">-</span>
</span></span><span style="display:flex;"><span>                                sum(triangleListMinus factors limit)
</span></span></code></pre></div><p>First I created a <code>factorsList</code> function that put together the <code>subsequences</code> and <code>lcm</code> functions to output a list of all the possible combinations of factors showing their length (number of factors) and their corresponding LCM.</p>
<p>The <code>triangleListPlus</code> and <code>triangleListMinus</code> functions transformed the factorsList elements to their triangle sums: one list for even number of factors, the other for odd.</p>
<p>Finally, the <code>sumOfMultiples</code> function takes the <em>plus</em> list and subtracts the <em>minus</em> list to get the final total.</p>
<p>Not very elegant, but it does the job. To check that it works, I&rsquo;ll try some test cases:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-haskell" data-lang="haskell"><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> sumOfMultiples <span style="color:#66d9ef">[]</span> <span style="color:#ae81ff">10000</span>         <span style="color:#75715e">-- should be 0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> sumOfMultiples [<span style="color:#ae81ff">3</span>] <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">16668333</span>
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> sumOfMultiples [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>] <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">23331668</span>
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> sumOfMultiples [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">6</span>] <span style="color:#ae81ff">10000</span>      <span style="color:#75715e">-- should be the same as [3]</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">16668333</span>
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> sumOfMultiples [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">7</span>] <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">27142139</span>
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> sumOfMultiples [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>] <span style="color:#ae81ff">10000</span>    <span style="color:#75715e">-- should be the same as [3,5]</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">23331668</span>
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> sumOfMultiples [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">11</span>] <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">29224307</span>
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> sumOfMultiples [<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">8</span>] <span style="color:#ae81ff">25</span>         <span style="color:#75715e">-- [4,6,8,12,16,18,20,24] = 108</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">108</span>
</span></span></code></pre></div><p>Look at that! Even the &ldquo;tricky&rdquo; test cases appear to pass. An empty list (no factors) returns 0, a case where the LCM of two factors <em>is equal to</em> one of the factors (3 and 6), and a case where a factor is repeated (3, 3, 5). The test case <code>sumOfMultiples [3,5,7,11] 10000</code> gives me my expected target answer: 29224307! And the last test case shows me that my method handles factors with overlapping LCMs. Not Bad!</p>
<p>But we can do better!</p>
<h2 id="refactoring">Refactoring</h2>
<p>I&rsquo;m probably not going to get much more improvement in overall performance but I can save a little time and memory space with a few tweaks.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-haskell" data-lang="haskell"><span style="display:flex;"><span> <span style="color:#66d9ef">import</span> Data.List (<span style="color:#a6e22e">foldl&#39;</span>, <span style="color:#a6e22e">nub</span>, <span style="color:#a6e22e">subsequences</span>, <span style="color:#a6e22e">length</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> lcmList <span style="color:#f92672">::</span> [<span style="color:#66d9ef">Integer</span>] <span style="color:#f92672">-&gt;</span> [<span style="color:#66d9ef">Integer</span>]
</span></span><span style="display:flex;"><span> lcmList factors <span style="color:#f92672">=</span> tail [sign fs <span style="color:#f92672">$</span> lcm&#39; fs <span style="color:#f92672">|</span> fs <span style="color:#f92672">&lt;-</span> subsequences <span style="color:#f92672">$</span> nub factors]
</span></span><span style="display:flex;"><span>                   <span style="color:#66d9ef">where</span> sign fs <span style="color:#f92672">|</span> odd (length fs) <span style="color:#f92672">=</span> id
</span></span><span style="display:flex;"><span>                                 <span style="color:#f92672">|</span> otherwise       <span style="color:#f92672">=</span> negate
</span></span><span style="display:flex;"><span>                         lcm&#39; <span style="color:#f92672">=</span> foldl&#39; lcm <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> triangle&#39; <span style="color:#f92672">::</span> <span style="color:#66d9ef">Integer</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Integer</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Integer</span>
</span></span><span style="display:flex;"><span> triangle&#39; <span style="color:#66d9ef">_</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span> triangle&#39; n f <span style="color:#f92672">=</span> f <span style="color:#f92672">*</span> n1 <span style="color:#f92672">*</span> (n1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) `div` <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#66d9ef">where</span> n1 <span style="color:#f92672">=</span> n `div` abs f
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> sumOfMultiples <span style="color:#f92672">::</span> [<span style="color:#66d9ef">Integer</span>] <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Integer</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Integer</span>
</span></span><span style="display:flex;"><span> sumOfMultiples factors limit <span style="color:#f92672">=</span> sum (triangle&#39; (limit<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">&lt;$&gt;</span> lcmList factors)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> main <span style="color:#f92672">::</span> <span style="color:#66d9ef">IO</span> ()
</span></span><span style="display:flex;"><span> main <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>   mapM_
</span></span><span style="display:flex;"><span>    print [
</span></span><span style="display:flex;"><span>     sumOfMultiples <span style="color:#66d9ef">[]</span> <span style="color:#ae81ff">10</span>,                  <span style="color:#75715e">-- should be 0</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">0</span>] <span style="color:#ae81ff">10</span>,                 <span style="color:#75715e">-- should be 0</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples <span style="color:#66d9ef">[]</span> <span style="color:#ae81ff">0</span>,                   <span style="color:#75715e">-- should be 0</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">0</span>] <span style="color:#ae81ff">0</span>,                  <span style="color:#75715e">-- should be 0</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">3</span>] <span style="color:#ae81ff">0</span>,                  <span style="color:#75715e">-- should be 0</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">5</span>] <span style="color:#ae81ff">3</span>,                  <span style="color:#75715e">-- should be 0</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">3</span>] <span style="color:#ae81ff">1000</span>,               <span style="color:#75715e">-- should be 166833</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>] <span style="color:#ae81ff">1000</span>,             <span style="color:#75715e">-- should be 166833</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>] <span style="color:#ae81ff">1000</span>,           <span style="color:#75715e">-- should be 166833</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">3</span>] <span style="color:#ae81ff">1000</span>,           <span style="color:#75715e">-- should be 166833</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">6</span>] <span style="color:#ae81ff">1000</span>,             <span style="color:#75715e">-- should be 166833</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">9</span>] <span style="color:#ae81ff">1000</span>,           <span style="color:#75715e">-- should be 166833</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">5</span>] <span style="color:#ae81ff">10</span>,                 <span style="color:#75715e">-- should be 5</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">15</span>] <span style="color:#ae81ff">10</span>,              <span style="color:#75715e">-- should be 5</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>] <span style="color:#ae81ff">10000</span>,            <span style="color:#75715e">-- should be 23331668</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">7</span>] <span style="color:#ae81ff">10000</span>,          <span style="color:#75715e">-- should be 27142139</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">11</span>] <span style="color:#ae81ff">10000</span>,       <span style="color:#75715e">-- should be 29224307</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">11</span>,<span style="color:#ae81ff">13</span>] <span style="color:#ae81ff">10000</span>,    <span style="color:#75715e">-- should be 30824867</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">11</span>,<span style="color:#ae81ff">13</span>,<span style="color:#ae81ff">17</span>] <span style="color:#ae81ff">10000</span>, <span style="color:#75715e">-- should be 31950148</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">6</span>] <span style="color:#ae81ff">25</span>,               <span style="color:#75715e">-- should be 108</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">201</span>,<span style="color:#ae81ff">203</span>,<span style="color:#ae81ff">207</span>] <span style="color:#ae81ff">10</span>,       <span style="color:#75715e">-- should be 0</span>
</span></span><span style="display:flex;"><span>     sumOfMultiples [<span style="color:#ae81ff">17</span>,<span style="color:#ae81ff">37</span>,<span style="color:#ae81ff">67</span>] <span style="color:#ae81ff">10000000000000000000000000000000000000</span>
</span></span><span style="display:flex;"><span>                ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> main
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">166833</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">166833</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">166833</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">166833</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">166833</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">166833</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">23331668</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">27142139</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">29224307</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">30824867</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">31950148</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">108</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">4896424079918373158057091331893790194458273022803312531143962223856863266</span>
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> lcmList [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">11</span>]
</span></span><span style="display:flex;"><span> [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">15</span>,<span style="color:#ae81ff">7</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">21</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">35</span>,<span style="color:#ae81ff">105</span>,<span style="color:#ae81ff">11</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">33</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">55</span>,<span style="color:#ae81ff">165</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">77</span>,<span style="color:#ae81ff">231</span>,<span style="color:#ae81ff">385</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1155</span>]
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> triangle&#39; <span style="color:#ae81ff">10000</span> <span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">3331665</span>
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> triangle&#39; <span style="color:#ae81ff">10000</span> (<span style="color:#f92672">-</span><span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span> <span style="color:#f92672">-</span><span style="color:#ae81ff">3331665</span>
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> triangle&#39; (<span style="color:#ae81ff">10000</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">&lt;$&gt;</span> lcmList [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">11</span>]
</span></span><span style="display:flex;"><span> [<span style="color:#ae81ff">16668333</span>,<span style="color:#ae81ff">9995000</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">3331665</span>,<span style="color:#ae81ff">7142142</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">2384046</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1426425</span>,<span style="color:#ae81ff">478800</span>,<span style="color:#ae81ff">4549545</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1519848</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">905905</span>,<span style="color:#ae81ff">301950</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">645645</span>,<span style="color:#ae81ff">218526</span>,<span style="color:#ae81ff">125125</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">41580</span>]
</span></span><span style="display:flex;"><span> λ<span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;</span>
</span></span></code></pre></div><p>First, I cleaned up the triangle function for readability and added a case where: if the only factor is zero then it returns zero (otherwise it would return a <code>divide by zero</code> error. I also designed it to negate the sum if the factor is negative. Finally, the new <code>triangle'</code> only takes a limit (Integer) and a list of factors (also Integers).</p>
<p>Second, I combined the old <code>factorsList, triangleListPlus, triangleListMinus</code> functions into one <code>lcmList</code> function. The subsequences function still creates the desired list of factor combinations I need &ndash; and the <code>lcmList</code> function transforms each sublist into its contribution (plus or minus) to the final sum.</p>
<p>Finally, the new <code>sumOfMultiples</code> maps the <code>triangle'</code> function over the <code>lcmList</code> and sums the resulting list for the final result.</p>
<p>You can see in the printout that this function handles empty lists, zero limits, zero factors, duplicate factors, similar factors (e.g. 3 and 6), and many factors as well as very large limits. It even handles negative factors &ndash; treating them as their positive equivalent.</p>
<h2 id="summary">Summary</h2>
<p>I started this journey with a simple programming exercise: <em>Find the sum of all the multiples of 3 or 5 below 1000.</em> I showed a simple and correct method of computing the answer using a list comprehension. However, that method took \(O(n)\) space and \(O(n)\) time (where \(n\) is the size of the limit) to compute the answer. Clearly this is not a good method if the limit is very large as it creates a large list in memory and takes tens of seconds or longer to compute when the limit is very large.</p>
<p>I then found a mathematical shortcut that calculates the sum of a series of natural numbers:</p>
<p>\(1 + 2 + 3 + &hellip; + n = n(n + 1)/2\)</p>
<p>From that insight I explored how multiple factors and their lowest common multiples added (or subtracted) to the final total. I then created a series of functions that produced the building blocks to produce the final total: and my final answer for any general case.</p>
<p>My final step was to refactor (rewrite) my functions and combine them to produce a simpler (and hopefully more readable) set of functions.</p>
<p>The final method takes \(O(2^k)\) space and \(O(2^k)\) time (which looks very scary) BUT this time \(k\) is the number of <em>factors</em> instead of the size of the limit! Assuming the number of factors is 20 or below (which I think is reasonable), this is a <strong>huge</strong> performance boost!</p>
<p>My journey began with a well known, easy(?) math/computing problem, solvable with a simple but inefficient solution. I went from a specific solution to a general case. Finally, I ended with a tidy and efficient solution.</p>
<p><em>Until next time!</em></p>
<h2 id="list-of-links">List of links</h2>
<p>Here&rsquo;s a list of things I learned (or at least practiced again):</p>
<ul>
<li>python
<ul>
<li><a href="https://docs.python.org/3/tutorial/datastructures.html">list comprehensions</a></li>
<li><a href="https://docs.python.org/3/library/time.html?highlight=time#module-time">time module functions</a></li>
</ul>
</li>
<li>haskell
<ul>
<li><a href="http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:lcm">prelude lcm</a></li>
<li><a href="https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html">Data.List lcm</a></li>
<li><a href="http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:-36-">prelude ($)</a></li>
<li><a href="http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:fmap">prelude (&lt;$&gt;)</a></li>
</ul>
</li>
<li><a href="http://www.wikiwand.com/en/Big_O_notation">Big O notation</a></li>
<li><a href="http://spacemacs.org/doc/QUICK_START.html#learning-spacemacs">Spacemacs</a></li>
<li><a href="http://orgmode.org/org.html#Summary">Org mode</a></li>
<li><a href="https://wiki.haskell.org/Emacs">haskell sub mode</a></li>
<li><a href="https://www.emacswiki.org/emacs/PythonProgrammingInEmacs">python sub mode</a></li>
<li><a href="https://www.emacswiki.org/emacs/Evil">everything else Emacs and Evil mode related</a></li>
</ul>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>I guess technically not a problem. Just that it is an inefficient algorithm. Also, not very memory space efficient since it builds a list before it finds a sum. But now we&rsquo;re getting ahead of ourselves!&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

</div>

        </div>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/foundation.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script>
<script>
  hljs.highlightAll();
</script>


<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>


<script src="https://unpkg.com/feather-icons"></script>
<script>
  feather.replace()
</script>

<div id="nav-border" class="container">
    
    <div class="nav-outer">
        <div class="nav-inner">
            
                
                    
                        <a class="internal" hyphens="none" href="/">
                            
                            Home
                        </a>
                    
                
                    
                        <a class="internal" hyphens="none" href="/blog">
                            
                            Blog
                        </a>
                    
                
                    
                        <a class="internal" hyphens="none" href="/about">
                            
                            About
                        </a>
                    
                
                    
                
            
        </div>
    </div>
    
</div>

</body>
</html>
